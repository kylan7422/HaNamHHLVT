<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Trip Input</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 40px auto;
      transition: background 0.3s, color 0.3s;
    }

    label {
      font-weight: bold;
      font-size: xx-large;
      display: block;
      margin-bottom: 8px;
    }

    input,
    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }

    #output,
    #confirmView {
      white-space: pre-wrap;
      background: var(--bg-output);
      color: var(--text);
      padding: 15px;
      border: 1px solid var(--border);
      margin-top: 30px;
    }

    .copy-btn {
      width: 100%;
      background: #4CAF50;
      color: white;
      font-size: 16px;
      border: none;
      padding: 12px;
      margin-top: 10px;
      cursor: pointer;
    }

    .copy-btn:hover {
      background-color: #45a049;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #121212;
        --text: #ffffff;
        --bg-output: #1e1e1e;
        --border: #555;
      }

      body {
        background: var(--bg);
        color: var(--text);
      }
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #ffffff;
        --text: #000000;
        --bg-output: #f9f9f9;
        --border: #ccc;
      }

      body {
        background: var(--bg);
        color: var(--text);
      }
    }
  </style>
</head>

<body>
  <label id="promptLabel">Th√°ng:</label>
  <input id="promptInput" type="text" autofocus />
  <button id="nextBtn" onclick="next()">Ti·∫øp t·ª•c</button>
  <div id="confirmView" style="display:none;"></div>
  <div id="output" style="display: none;"></div>

  <script>
    const state = {
      step: 0,
      data: {},
      tripIndex: 0,
      trips: [],
    };

    const steps = [
      { key: 'thang', label: 'Th√°ng:' },
      { key: 'nam', label: 'NƒÉm:' },
      { key: 'chuyenN', label: 'C√≥ bao nhi√™u chuy·∫øn?' },
    ];

    const tripSteps = [
      { key: 'Ngay', label: 'Ng√†y (1‚Äì31):' },
      { key: 'SoXe', label: 'Ch·ªçn xe (1: 51C 82470, 2: 51D 26262, 3: 51C 86062):' },
      { key: 'NoiDen', label: '1: Ng√¥ Th·ªã Kim T√¢n,\n 2: Pet co\n 3: H∆∞ng Th·ªãnh,\nN∆°i ƒë·∫øn (1‚Äì3) ho·∫∑c g√µ tr·ª±c ti·∫øp:' },
      { key: 'Tien', label: 'Nh·∫≠p ti·ªÅn (vd: 2000000):' }
    ];

    const NoiDenOption = {
      1: 'Ng√¥ Th·ªã Kim T√¢n',
      2: 'Pet co',
      3: 'H∆∞ng Th·ªãnh'
    };

    const SoXeOption = { 1: '51C 82470', 2: '51D 26262', 3: '51C 86062' };

    const promptLabel = document.getElementById("promptLabel");
    const promptInput = document.getElementById("promptInput");
    const nextBtn = document.getElementById("nextBtn");
    const outputBox = document.getElementById("output");
    const confirmView = document.getElementById("confirmView");

    promptInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        next();
      }
    });

    function next() {
      const val = promptInput.value.trim();
      // if (val === "") return;

      if (state.step < steps.length) {
        const current = steps[state.step];
        state.data[current.key] = val;
        state.step++;
        if (state.step < steps.length) {
          showPrompt(steps[state.step]);
        } else {
          state.tripStep = 0;
          state.tripIndex = 0;
          state.trips = [];
          showTripPrompt();
        }
      } else {
        const trip = state.trips[state.tripIndex] || {};
        const tripStep = tripSteps[state.tripStep];

        if (tripStep.key === 'NoiDen') {
          trip.NoiDen = /^[1-4]$/.test(val) ? NoiDenOption[parseInt(val)] : val;
        } else {
          trip[tripStep.key] = val;
        }

        state.trips[state.tripIndex] = trip;
        state.tripStep++;

        if (state.tripStep < tripSteps.length) {
          showTripPrompt();
        } else {
          state.tripIndex++;
          if (state.tripIndex < parseInt(state.data.chuyenN)) {
            state.tripStep = 0;
            showTripPrompt();
          } else {
            showConfirmView();
          }
        }
      }

      promptInput.value = "";
    }

    function showPrompt(step) {
      promptLabel.innerText = step.label;
      promptInput.focus();
    }

    function showTripPrompt() {
      const step = tripSteps[state.tripStep];
      promptLabel.innerText = `Chuy·∫øn ${state.tripIndex + 1} - ${step.label}`;
      promptInput.focus();
    }

    function showConfirmView() {
      promptInput.style.display = "none";
      promptLabel.style.display = "none";
      nextBtn.style.display = "none";
      confirmView.style.display = "block";

      let text = `Th√°ng: ${state.data.thang}\nNƒÉm: ${state.data.nam}\nS·ªë chuy·∫øn: ${state.data.chuyenN}\n\n`;
      state.trips.forEach((trip, i) => {
        text += `üìç Chuy·∫øn ${i + 1}:\n  - Ng√†y: ${trip.Ngay}\n  - S·ªë xe: ${SoXeOption[parseInt(trip.SoXe)]}\n  - N∆°i ƒë·∫øn: ${trip.NoiDen}\n   - Ti·ªÅn: ${trip.Tien}\n\n`;
      });

      confirmView.innerText = text;

      const btn = document.createElement("button");
      btn.innerText = "X√°c nh·∫≠n v√† t·∫°o l·ªánh";
      btn.onclick = showOutput;
      confirmView.appendChild(btn);

      btn.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          showOutput();
        }
      });
    }

    function showOutput() {
      confirmView.style.display = "none";
      outputBox.style.display = "block";

      let text = `conda activate hhlvt && cd ~/Documents/ExcelGeneratorHHLVT/HaNam && echo -e \"${state.data.thang}\\n${state.data.nam}\\n${state.data.chuyenN}`;
      state.trips.forEach((trip) => {
        text += `\\n${trip.Ngay}`;
        text += `\\n${trip.SoXe}`;
        text += `\\n${trip.NoiDen}`;
        text += `\\n${trip.Tien}`;
      });
      text += `\" | python main.py`;
      outputBox.innerText = text;

      const copyBtn = document.createElement("button");
      copyBtn.innerText = "Sao ch√©p l·ªánh";
      copyBtn.className = "copy-btn";
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(text).then(() => {
          copyBtn.innerText = "ƒê√£ sao ch√©p!";
          setTimeout(() => copyBtn.innerText = "Sao ch√©p l·ªánh", 2000);
        });
      };
      outputBox.appendChild(copyBtn);
    }

    showPrompt(steps[0]);
  </script>
</body>

</html>